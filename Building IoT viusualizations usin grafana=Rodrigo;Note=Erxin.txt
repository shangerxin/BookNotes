Building IoT viusualizations usin grafana=Rodrigo;Note=Erxin 

# Connecting IoT devices  
-  standard specification of MQTT 3.1.1 at this link:

http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/mqtt-v3.1.1.html

- approach is using JSON objects to package information in a single topic, as shown in the following example:

{ "sensorType": "Thermometer", 
"sensorModel": "AM2302", 
"temp": 25, 
"hum": 40}


- QoS implementation. There are three levels of QoS, as follows:

At most once (level 0)
At least once (level 1)
Exactly once (level 2)

- The main improvements that come with MQTT 5 are as follows:

Better scalability support
Improved error reporting
More efficiency in small clients
The adding of user properties

- MQTT clients, Mosquitto client
You can just use the MQTT client that comes with the Mosquitto broker. Whenever you install the Mosquitto broker, you also install the MQTT client.

For the full documentation, go to https://mosquitto.org/documentation/.

- MQTT Explorer is a cool open source software developed by Thomas Nordquist. You can find it here: http://mqtt-explorer.com.

- MQTTLens
The third option is a Chrome extension

- online MQTT brokers available out there. We will see two options: Mosquitto and HiveMQ

- Sending data through HTTP
HyperText Transfer Protocol (HTTP) is one of the foundation protocols of the internet. 

- What is CoAP?
Constrained Application Protocol (CoAP), as its name implies, is tailored to run in constrained devices, such as microcontrollers.


# Set data sources for grafana 
- available to use with Grafana:

MySQL
MongoDB
Graphite
InfluxDB
OpenTSDB
PostgreSQL
Elasticsearch
Azure Monitor
Prometheus
Loki
Test data
CSV files and Excel files

- A relational database management system (RDBMS) is a system that manages data according to a relational model.

- NoSQL databases that you can use with Grafana:

MongoDB (Enterprise Grafana version)
InfluxDB
OpenTSDB
ElastichSearch
OpenSearch
Apache Cassandra
Prometheus
Graphite

- Grafana allows using live data since version 8.0. It uses WebSocket connections to exchange data in a quasi-real-time way.

Telegraf
You can use the PUSH feature from a Telegraf instance.

According to its GitHub repository, Telegraf is an agent for collecting, processing, aggregating, and writing metrics. It has been developed by InfluxData and it belongs to the InfluxDB TICK Stack



# Using time series databases 
- Installing and configuring InfluxDB
In this section, you will learn how to install and configure an InfluxDB instance.

- Bucket
In InfluxDB, the data is stored in buckets. A bucket consists of a database that is related to a retention period.

-  any of the following languages:

Arduino
C#
Go
Java
JavaScript for browsers
Kotlin
Node.js
PHP
Python
R
Ruby
Scala
Swift

- The implementation of OpenTSDB can be laborious, so we will use a basic approach to it.


# Getting data and build dashboards
- additional configuration is related to a particular implementation of InfluxDB, such as Transport Layer Security (TLS) settings, timeouts, or custom HTTP headers.

- Add InfluxDB data source 

each of them in detail:

Data source: First, at the top, you have to select the data source. Remember that you can have more than one data source of the same type. For example, you can have two InfluxDB data sources, each of them accessing different InfluxDB instances.
Bucket: Then, you have to select the correct bucket. An InfluxDB instance can manage several buckets.
Measurement: After you have selected the bucket, you have to specify the measurement.
Tags: If there are tags in the bucket, you can select them here. Remember that tags allow you to perform efficient queries.
Field: Then, you can choose the field that you are interested in. The field is associated with the field value that you want to display in the dashboard.
Field options: The field options let you apply different types of numeric transformations. You can select them from several menus – Aggregation, Selectors, Transformations, Predictors, Math, Aliasing, and Fields. We will take a look at all these options later in this book.
Grouping and options: Here, you can select the granularity of data and the way that you want to connect data points. In the example in Figure 6.2, the data is connected by linear interpolations, but you can let them be unconnected.
Format: This option lets you specify how you want to see the data. You could choose between Time series, Tabular, and Logs.
Other options: Finally, you can name the pattern using ALIAS, and you can specify some other parameters related to the type of data source that you are using. In this case, you have the following options – TIMEZONE, ORDER BY TIME, LIMIT, and SLIMIT.

- To create a dashboard, you have to go to the plus sign in the left menu and click on Dashboard. A new, empty dashboard will be created.

- To create panels, where you will be able to specify the type of visualization that you need. So, click on Add an empty panel

panel options are:

Title: You can and should specify a title for each of your panels. This way, you will be able to identify each panel and avoid confusion.
Description: Even when the purpose of some panels is quite evident, it is always a good idea to describe the objective and characteristics of a panel.
Transparent background: Enabling this option, you can set the transparency of the panel background.
Panel links: You can specify links to any valid URL, including websites, other dashboards, or panels. The links will be shown in the upper-left corner of the panel.

- legend calculations all the available calculations, visit the following link: https://grafana.com/docs/grafana/latest/panels/calculations-list/.

- graph styles 

- axies 

- categorical data
Sometimes, you need to know whether a pump is working or not, or if a light is on or off.

- Histograms and heatmaps
In this section, we will explore two visualization panels – Histograms and Heatmaps. Let’s start with histograms.


# Managging plugins 
- Installing a plugin with the Grafana CLI

$ grafana-cli plugins install <the-plugin-id>
$ grafana-cli plugins install <the-plugin-id> <version>
$ grafana-cli plugins list-remote
$ grafana-cli plugins ls
$ grafana-cli plugins update <plugin-id>
$ grafana-cli plugins update-all
$ grafana-cli plugins remove <plugin-id>

- available plugins in the following link:

https://grafana.com/grafana/plugins/.



# Organizing and Managing Dashboards
- Building and showing playlists
A playlist is a series of dashboards that are shown in sequence.
- Annotations are a great tool for building insights into the data.

- With ad hoc filters, you can create key/value filters that you can use in any metric query for a specific data source. Ad hoc filters are not a query expression.

- global variables

$__dashboard: This variable lets you specify the name of a dashboard.
$__from and $__to: These are time range variables. They are specified as epoch milliseconds by default, but you can change the formatting with the following options: ${__from:date}, ${__from:date:iso}, ${__from:date:seconds}, and ${__from:date:YYYY-MM}. The same applies to ${__to}. You can also use these variables in the URL of a dashboard (for example, https://play.grafana.org/d/000000012/grafana-play-home?viewPanel=2&orgId=1?from=now-6h&to=now).
$__interval: This variable lets you specify the grouping of data points. Grafana calculates the interval according to the time range and the resolution of the screen. If there are more data points than the number of pixels in the panel, Grafana will group them to fit the visualization. So, if you want to see four months of data, a one-day interval will be more convenient than one hour. The automatic calculation performed by Grafana approximates to (to – from)/resolution.
$__interval_ms: This variable is the $__interval variable, but in milliseconds. So, if $__interval is 60s, then $__interval_ms is 60000.
$__name: This variable is used only with the Singlestat panel. You can use it in the prefix or suffix fields on the Options tab. The variable will be replaced with the series name or alias.
$__org: This variable represents the ID of the organization. For example, to obtain the name of the current organization, you can use ${__org.name}.
$__user: This variable provides the following: ${__user.id} is the ID of the current user, ${__user.login} is the login handle, and ${__user.email} is the email of the user.
$__range: This variable is only supported by Prometheus and Loki data sources. It is related to the rate function.
$timeFilter or $__timeFilter: This variable returns the current time range as an expression. For example, if you have Last 12 hours, the expression is time > now() – 12h.

- With URL links, you can link any type of URL, including dashboards, panels, and external sites.

- Panel links are pretty much the same as dashboard links. You can link to dashboards, panels, and external sites.

- With data links, you can show more specific data. You can pass names, values, templates, global variables, and many more options.

- Finally, you can publish the snapshot on your local instance, or use snapshot.raintank.io. This last option is a free service offered by Grafana Labs.


# Performing analytics in grafana 
-  use transformations in Grafana to process the data from a query before Grafana shows it.

-  transformation offers two modes:

Series to rows

Reduce fields: This keeps the structure from the queries and creates a frame for each of them

- following links:

https://plotly.com/javascript/configuration-options/

https://plotly.com/javascript/plotly-fundamentals/

If you prefer, you can use the Script textbox instead of the three textboxes described before.


# Alerting and notification in grafana 
- lerting manager is enabled, you can do the following:

Create alert rules.
View current rules and manage their state.
View the state and health of rules.
Add or modify contact points (notification systems).
Add or modify notification policies.
Add or modify silences.

- Performing Analytics in Grafana:

https://grafana.com/docs/grafana/latest/panels/query-a-data-source/use-expressions-to-manipulate-data/about-expressions/

- Contact points tab on the Alerting page

- list of available contact point types at the following link: https://grafana.com/docs/grafana/latest/alerting/unified-alerting/contact-points/.

- Grouping allows you to route alert notifications in an efficient way when large



# Integrating grafana with other platforms 
# Using with prometheus 
- Prometheus is an open source monitoring and alerting system. It was developed by SoundCloud in 2012, but at the time of writing, it is a standalone project.

- MQTT brokers using either https://github.com/inovex/mqtt_blackbox_exporter or https://github.com/hikhvar/mqtt2prometheus.

- American Power Conversion (APC) Uninterrupted Power Systems (UPS). You can find the exporter at https://github.com/mdlayher/apcupsd_exporter.


# Using grafana with OpenSearch 
- The OpenSearch system allows searching and analyzing data from several sources. 

OpenSearch: This is the core component. It includes the search engine and store.
OpenSearch Dashboards: Implements visualizations and the search user interface.
Security: Performs access control and authentication.
Alerting: As the name implies, this component manages condition-based alerts and notifications.
SQL: Lets you use SQL queries to search data.
Index State Management: Automates index operations.
KNN: Implements the K-nearest neighbors (KNN), an algorithm of supervised classification.
Performance Analyzer: Monitors and optimizes your cluster.
Anomaly detection: Detects anomalies in the data streaming.
ML Commons plugin: Lets you train and run machine learning models.
Asynchronous search: Runs search requests in the background.
Cross-cluster replication: With this tool, you can replicate your data across several clusters.


# Showing data from LibreNMS in grafana 
- network monitoring, a Network Management System (NMS). It provides metrics that can be accessed through an InfluxDB database

LibreNMS are the following:

Automatic discovery of devices: LibreNMS uses SNMP, CDP, LLDP, OSPF, BGP, FDP, and ARP to find devices in a network.
API access: You can interact with LibreNMS using its API to manage, graph, and get data.
Alerting: LibreNMS has a very customizable alerting system. You can build your alerts or use the templates provided by default.
Automatic updates: LibreNMS has a script to check on updates and run upgrades at midnight.
Distributed polling: You can build a large system with distributed small nodes that send data to a central server.
Billing system: You can generate bills based on the utilization of specific interfaces.
Apps: You can access LibreNMS using native apps on iOS and Android.

- SNMP is the main protocol that LibreNMS uses for discovering and managing network devices. 

- Building diagrams with draw.io
draw.io is a diagram software that you can use for free either online or locally. draw.io allows you to draw different types of diagrams

-  FlowCharting panel
To install the FlowCharting panel plugin, you can use any of the methods described


# Integrations for grafana cloud 
- agent 
Using the Linux Node integration.
Using the Home Assistant integration.
Using the RabbitMQ integration.

- Home Assistant is an open source home automation system. You can run it locally on your server or even on a Raspberry Pi.

https://www.home-assistant.io/.

- RabbitMQ integration
RabittMQ is an open source message broker. You can deploy it on a single server or in a cluster, either in the cloud or locally.

https://www.rabbitmq.com/.